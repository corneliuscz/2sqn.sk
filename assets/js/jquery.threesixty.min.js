!function(t,e,o){function n(e,o){a=this,this.element=e,d=d=t.extend({},s,o),this._defaults=s,this._name=i,t.inArray(d.dragDirection,r)<0&&(d.dragDirection=s.dragDirection),this.init()}var a,i="threeSixty",s={dragDirection:"horizontal",useKeys:!1,draggable:!0,points:[],posit:[]},r=["horizontal","vertical"],d={},c={},l=[],p=0;t.fn.destroy=n.prototype.destroy=function(){d.useKeys===!0&&t(o).unbind("keydown",this.onKeyDown),t(this).removeData(),c.html("")},t.fn.nextFrame=n.prototype.nextFrame=function(){t(this).each(function(){var e=t(this),o=e.data("lastVal")||0,n=e.data("count"),a=d.posit[0].length,i=0;for(o+=1,e.data("lastVal",o),o>=n?o%=n-1:-n>=o&&(o%=n-1),o>0&&(o=n-o),o=Math.abs(o),e.find(".threesixty-frame").css({display:"none"}),e.find(".threesixty-frame:eq("+o+")").css({display:"block"}),i;a>i;i++)t("."+d.posit[o][i][0]).css("display","block").css(d.posit[o][i][1],d.posit[o][i][2])})},t.fn.prevFrame=n.prototype.prevFrame=function(){t(this).each(function(){var e=t(this),o=e.data("lastVal")||0,n=e.data("count"),a=d.posit[0].length,i=0;for(o-=1,e.data("lastVal",o),o>=n?o%=n-1:-n>=o&&(o%=n-1),o>0&&(o=n-o),o=Math.abs(o),e.find(".threesixty-frame").css({display:"none"}),e.find(".threesixty-frame:eq("+o+")").css({display:"block"}),i;a>i;i++)t("."+d.posit[o][i][0]).css("display","block").css(d.posit[o][i][1],d.posit[o][i][2])})},n.prototype.init=function(){var e=t(this.element);c=e,e.each(function(){var e=t(this),o=e.data("path"),n=e.data("count");l.push({path:o,count:n,loaded:0,$el:e}),p+=n}),b(),this.initLoad()},n.prototype.initLoad=function(){var e,o,n=0,a=l.length;for(c.addClass("preloading"),n;a>n;n++)for(o=0;o<l[n].count;o++)e=l[n].path.replace("{index}",o),t("<img/>").data("index",n).attr("src",e).load(this.onLoadComplete)},n.prototype.onLoadComplete=function(e){var o=t(e.currentTarget).data("index"),n=l[o];n.loaded++,n.loaded===n.count&&a.onLoadAllComplete(o)},n.prototype.onLoadAllComplete=function(t){var e=l[t].$el,o="",n=l[t].count,a=l[t].path,i=0;for(e.html(""),e.removeClass("preloading"),i;n>i;i++){var s=0===i?"block":"none";o+='<img class="threesixty-frame" style="display:'+s+';" data-index="'+i+'" src="'+a.replace("{index}",i)+'"/>'}e.html(o),this.attachHandlers(t)};var u=0,h=0,f=null,y=0,v=0,m=0,g=!1;n.prototype.attachHandlers=function(e){var n=this,a=l[e].$el;if(d.draggable&&"undefined"!=typeof o.ontouchstart&&"undefined"!=typeof o.ontouchmove&&"undefined"!=typeof o.ontouchend&&"undefined"!=typeof o.ontouchcancel){var i=a.get()[0];i.addEventListener("touchstart",n.onTouchStart),i.addEventListener("touchmove",n.onTouchMove),i.addEventListener("touchend",n.onTouchEnd),i.addEventListener("touchcancel",n.onTouchEnd)}a.mousedown(function(e){e.preventDefault(),h=t(this).data("count"),f=t(this),u=e.screenY,m=f.data("lastVal")||0,v=f.data("lastX")||0,y=f.data("lastY")||0,g=!0,f.trigger("down")}),d.useKeys===!0&&t(o).bind("keydown",n.onKeyDown),t(o,"html","body").mouseup(n.onMouseUp),t(o).blur(n.onMouseUp),t("body").mousemove(function(t){n.onMove(t.screenX,t.screenY)})},n.prototype.onTouchStart=function(e){var o=e.touches[0];e.preventDefault(),f=t(e.target).parent(),h=f.data("count"),startX=o.pageX,u=o.pageY,m=f.data("lastVal")||0,v=f.data("lastX")||0,y=f.data("lastY")||0,g=!0,f.trigger("down")},n.prototype.onTouchMove=function(t){t.preventDefault();var e=t.touches[0];a.onMove(e.pageX,e.pageY)},n.prototype.onTouchEnd=function(){},n.prototype.onMove=function(e,o){if(g){var n=e,a=o,i=0;if(f.trigger("move"),"vertical"===d.dragDirection)i=a>y?m+1:m-1;else if(n>v)i=m+1;else{if(n===v)return;i=m-1}for(m=i,y=a,v=n,f.data("lastY",y),f.data("lastX",v),f.data("lastVal",m),i>=h?i%=h-1:-h>=i&&(i%=h-1),i>0&&(i=h-i),i=Math.abs(i),f.find(".threesixty-frame").css({display:"none"}),f.find(".threesixty-frame:eq("+i+")").css({display:"block"}),ln=d.posit[0].length,j=0,j;ln>j;j++)t("."+d.posit[i][j][0]).css("display","block").css(d.posit[i][j][1],d.posit[i][j][2])}},n.prototype.onKeyDown=function(t){switch(t.keyCode){case 37:c.prevFrame();break;case 39:c.nextFrame()}},n.prototype.onMouseUp=function(){g=!1,f.trigger("up")};var b=function(){o.body.onselectstart=function(){return!1},o.body.ondragstart=function(){return!1}};t.fn[i]=function(e){return this.each(function(){t.data(this,"plugin_"+i)||t.data(this,"plugin_"+i,new n(this,e))})}}(jQuery,window,document);