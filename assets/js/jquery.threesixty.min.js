!function(t,e,i){function s(e,i){n=this,this.element=e,l=l=t.extend({},a,i),this._defaults=a,this._name=o,t.inArray(l.dragDirection,r)<0&&(l.dragDirection=a.dragDirection),this.init()}var n,o="threeSixty",a={dragDirection:"horizontal",useKeys:!1,draggable:!0,points:[],posit:[]},r=["horizontal","vertical"],l={},c={},d=[],h=0;t.fn.destroy=s.prototype.destroy=function(){l.useKeys===!0&&t(i).unbind("keydown",this.onKeyDown),t(this).removeData(),c.html("")},t.fn.nextFrame=s.prototype.nextFrame=function(){t(this).each(function(){var e=t(this),i=e.data("lastVal")||0,s=e.data("count"),n=l.posit[0].length,o=0;for(i+=1,e.data("lastVal",i),i>=s?i%=s-1:-s>=i&&(i%=s-1),i>0&&(i=s-i),i=Math.abs(i),e.find(".threesixty-frame").css({display:"none"}),e.find(".threesixty-frame:eq("+i+")").css({display:"block"}),o;n>o;o++)t("."+l.posit[i][o][0]).css("display","block").css(l.posit[i][o][1],l.posit[i][o][2])})},t.fn.prevFrame=s.prototype.prevFrame=function(){t(this).each(function(){var e=t(this),i=e.data("lastVal")||0,s=e.data("count"),n=l.posit[0].length,o=0;for(i-=1,e.data("lastVal",i),i>=s?i%=s-1:-s>=i&&(i%=s-1),i>0&&(i=s-i),i=Math.abs(i),e.find(".threesixty-frame").css({display:"none"}),e.find(".threesixty-frame:eq("+i+")").css({display:"block"}),o;n>o;o++)t("."+l.posit[i][o][0]).css("display","block").css(l.posit[i][o][1],l.posit[i][o][2])})},s.prototype.init=function(){var e=t(this.element);c=e,e.each(function(){var e=t(this),i=e.data("path"),s=e.data("count");d.push({path:i,count:s,loaded:0,$el:e}),h+=s}),_(),this.initLoad()},s.prototype.initLoad=function(){var e,i,s=0,n=d.length;for(c.addClass("preloading"),s;n>s;s++)for(i=0;i<d[s].count;i++)e=d[s].path.replace("{index}",i),t("<img/>").data("index",s).attr("src",e).load(this.onLoadComplete)},s.prototype.onLoadComplete=function(e){var i=t(e.currentTarget).data("index"),s=d[i];s.loaded++,s.loaded===s.count&&n.onLoadAllComplete(i)},s.prototype.onLoadAllComplete=function(t){var e=d[t].$el,i="",s=d[t].count,n=d[t].path,o=0,a=l.points.length,r=0;for(e.html(""),e.removeClass("preloading"),i+='<div class="threesixty-frame-notes">',r;a>r;r++)i+='<a href="'+l.points[r][2]+'" title="'+l.points[r][3]+'" class="icon icon-i-w-spot '+l.points[r][0]+'" style="'+l.points[r][1]+'"></a>';for(i+="</div>",o;s>o;o++){var c=0===o?"block":"none";i+='<img class="threesixty-frame" style="display:'+c+';" data-index="'+o+'" src="'+n.replace("{index}",o)+'"/>'}e.html(i),this.attachHandlers(t)};var p=0,f=0,u=null,g=0,m=0,v=0,b=!1;s.prototype.attachHandlers=function(e){var s=this,n=d[e].$el;if(l.draggable&&"undefined"!=typeof i.ontouchstart&&"undefined"!=typeof i.ontouchmove&&"undefined"!=typeof i.ontouchend&&"undefined"!=typeof i.ontouchcancel){var o=n.get()[0];o.addEventListener("touchstart",s.onTouchStart),o.addEventListener("touchmove",s.onTouchMove),o.addEventListener("touchend",s.onTouchEnd),o.addEventListener("touchcancel",s.onTouchEnd)}n.mousedown(function(e){e.preventDefault(),f=t(this).data("count"),u=t(this),p=e.screenY,v=u.data("lastVal")||0,m=u.data("lastX")||0,g=u.data("lastY")||0,b=!0,u.trigger("down")}),l.useKeys===!0&&t(i).bind("keydown",s.onKeyDown),t(i,"html","body").mouseup(s.onMouseUp),t(i).blur(s.onMouseUp),t("body").mousemove(function(t){s.onMove(t.screenX,t.screenY)})},s.prototype.onTouchStart=function(e){var i=e.touches[0];e.preventDefault(),u=t(e.target).parent(),f=u.data("count"),startX=i.pageX,p=i.pageY,v=u.data("lastVal")||0,m=u.data("lastX")||0,g=u.data("lastY")||0,b=!0,u.trigger("down")},s.prototype.onTouchMove=function(t){t.preventDefault();var e=t.touches[0];n.onMove(e.pageX,e.pageY)},s.prototype.onTouchEnd=function(){},s.prototype.onMove=function(e,i){if(b){var s=e,n=i,o=0;if(u.trigger("move"),"vertical"===l.dragDirection)o=n>g?v+1:v-1;else if(s>m)o=v+1;else{if(s===m)return;o=v-1}for(v=o,g=n,m=s,u.data("lastY",g),u.data("lastX",m),u.data("lastVal",v),o>=f?o%=f-1:-f>=o&&(o%=f-1),o>0&&(o=f-o),o=Math.abs(o),u.find(".threesixty-frame").css({display:"none"}),u.find(".threesixty-frame:eq("+o+")").css({display:"block"}),ln=l.posit[0].length,j=0,j;ln>j;j++)t("."+l.posit[o][j][0]).css("display","block").css(l.posit[o][j][1],l.posit[o][j][2])}},s.prototype.onKeyDown=function(t){switch(t.keyCode){case 37:c.prevFrame();break;case 39:c.nextFrame()}},s.prototype.onMouseUp=function(){b=!1,u.trigger("up")};var _=function(){i.body.onselectstart=function(){return!1},i.body.ondragstart=function(){return!1}};t.fn[o]=function(e){return this.each(function(){t.data(this,"plugin_"+o)||t.data(this,"plugin_"+o,new s(this,e))})}}(jQuery,window,document);