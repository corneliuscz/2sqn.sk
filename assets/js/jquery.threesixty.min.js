!function(t,e,o){function a(e,o){n=this,this.element=e,d=d=t.extend({},i,o),this._defaults=i,this._name=s,t.inArray(d.dragDirection,r)<0&&(d.dragDirection=i.dragDirection),this.init()}var n,s="threeSixty",i={dragDirection:"horizontal",useKeys:!1,draggable:!0,points:[],posit:[]},r=["horizontal","vertical"],d={},c={},l=[],p=0;t.fn.destroy=a.prototype.destroy=function(){d.useKeys===!0&&t(o).unbind("keydown",this.onKeyDown),t(this).removeData(),c.html("")},t.fn.nextFrame=a.prototype.nextFrame=function(){t(this).each(function(){var e=t(this),o=e.data("lastVal")||0,a=e.data("count"),n=d.posit[0].length,s=0;for(o+=1,e.data("lastVal",o),o>=a?o%=a-1:-a>=o&&(o%=a-1),o>0&&(o=a-o),o=Math.abs(o),e.find(".threesixty-frame").css({display:"none"}),e.find(".threesixty-frame:eq("+o+")").css({display:"block"}),s;n>s;s++)t("."+d.posit[o][s][0]).css("display","block").css(d.posit[o][s][1],d.posit[o][s][2])})},t.fn.prevFrame=a.prototype.prevFrame=function(){t(this).each(function(){var e=t(this),o=e.data("lastVal")||0,a=e.data("count"),n=d.posit[0].length,s=0;for(o-=1,e.data("lastVal",o),o>=a?o%=a-1:-a>=o&&(o%=a-1),o>0&&(o=a-o),o=Math.abs(o),e.find(".threesixty-frame").css({display:"none"}),e.find(".threesixty-frame:eq("+o+")").css({display:"block"}),s;n>s;s++)t("."+d.posit[o][s][0]).css("display","block").css(d.posit[o][s][1],d.posit[o][s][2])})},a.prototype.init=function(){var e=t(this.element);c=e,e.each(function(){var e=t(this),o=e.data("path"),a=e.data("count");l.push({path:o,count:a,loaded:0,$el:e}),p+=a}),b(),this.initLoad()},a.prototype.initLoad=function(){var e,o,a=0,n=l.length;for(c.addClass("preloading"),a;n>a;a++)for(o=0;o<l[a].count;o++)e=l[a].path.replace("{index}",o),t("<img/>").data("index",a).attr("src",e).load(this.onLoadComplete)},a.prototype.onLoadComplete=function(e){var o=t(e.currentTarget).data("index"),a=l[o];a.loaded++,a.loaded===a.count&&n.onLoadAllComplete(o)},a.prototype.onLoadAllComplete=function(e){var o=l[e].$el,a="",n=l[e].count,s=l[e].path,i=0;for(o.html(""),o.removeClass("preloading"),i;n>i;i++){var r=0===i?"block":"none";a+='<img class="threesixty-frame" style="display:'+r+';" data-index="'+i+'" src="'+s.replace("{index}",i)+'"/>'}o.html(a),t(".threesixty-frame-notes").css("display","block"),this.attachHandlers(e)};var u=0,h=0,f=null,y=0,v=0,m=0,g=!1;a.prototype.attachHandlers=function(e){var a=this,n=l[e].$el;if(d.draggable&&"undefined"!=typeof o.ontouchstart&&"undefined"!=typeof o.ontouchmove&&"undefined"!=typeof o.ontouchend&&"undefined"!=typeof o.ontouchcancel){var s=n.get()[0];s.addEventListener("touchstart",a.onTouchStart),s.addEventListener("touchmove",a.onTouchMove),s.addEventListener("touchend",a.onTouchEnd),s.addEventListener("touchcancel",a.onTouchEnd)}n.mousedown(function(e){e.preventDefault(),h=t(this).data("count"),f=t(this),u=e.screenY,m=f.data("lastVal")||0,v=f.data("lastX")||0,y=f.data("lastY")||0,g=!0,f.trigger("down")}),d.useKeys===!0&&t(o).bind("keydown",a.onKeyDown),t(o,"html","body").mouseup(a.onMouseUp),t(o).blur(a.onMouseUp),t("body").mousemove(function(t){a.onMove(t.screenX,t.screenY)})},a.prototype.onTouchStart=function(e){var o=e.touches[0];e.preventDefault(),f=t(e.target).parent(),h=f.data("count"),startX=o.pageX,u=o.pageY,m=f.data("lastVal")||0,v=f.data("lastX")||0,y=f.data("lastY")||0,g=!0,f.trigger("down")},a.prototype.onTouchMove=function(t){t.preventDefault();var e=t.touches[0];n.onMove(e.pageX,e.pageY)},a.prototype.onTouchEnd=function(){},a.prototype.onMove=function(e,o){if(g){var a=e,n=o,s=0;if(f.trigger("move"),"vertical"===d.dragDirection)s=n>y?m+1:m-1;else if(a>v)s=m+1;else{if(a===v)return;s=m-1}for(m=s,y=n,v=a,f.data("lastY",y),f.data("lastX",v),f.data("lastVal",m),s>=h?s%=h-1:-h>=s&&(s%=h-1),s>0&&(s=h-s),s=Math.abs(s),f.find(".threesixty-frame").css({display:"none"}),f.find(".threesixty-frame:eq("+s+")").css({display:"block"}),ln=d.posit[0].length,j=0,j;ln>j;j++)t("."+d.posit[s][j][0]).css("display","block").css(d.posit[s][j][1],d.posit[s][j][2])}},a.prototype.onKeyDown=function(t){switch(t.keyCode){case 37:c.prevFrame();break;case 39:c.nextFrame()}},a.prototype.onMouseUp=function(){g=!1,f.trigger("up")};var b=function(){o.body.onselectstart=function(){return!1},o.body.ondragstart=function(){return!1}};t.fn[s]=function(e){return this.each(function(){t.data(this,"plugin_"+s)||t.data(this,"plugin_"+s,new a(this,e))})}}(jQuery,window,document);